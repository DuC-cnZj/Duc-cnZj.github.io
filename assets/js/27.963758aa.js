(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{752:function(s,t,a){s.exports=a.p+"assets/img/image-20220902171649394.d358368c.png"},753:function(s,t,a){s.exports=a.p+"assets/img/image-20220902171745117.8ea7f834.png"},754:function(s,t,a){s.exports=a.p+"assets/img/image-20220902171835905.bd704fe0.png"},919:function(s,t,a){"use strict";a.r(t);var e=a(6),p=Object(e.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"k8s-svc-externalips-使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#k8s-svc-externalips-使用"}},[s._v("#")]),s._v(" k8s svc externalIPs 使用")]),s._v(" "),e("p",[s._v("在平时一般用不到这个选项，但是如果你有 svc 是 "),e("code",[s._v("loadbalancer")]),s._v(" 类型的，并且还配置了 waf")]),s._v(" "),e("p",[s._v("那么你用的到，流量经过 waf 转发到 nginx svc pod 中，试想一下，如果是从集群内部pod访问指向waf的域名，那么是不是流量会绕一圈，但是如果你把waf ip设置到 "),e("code",[s._v("externalIPs")]),s._v(" 上，流量就会直接在集群内部流动。")]),s._v(" "),e("h3",{attrs:{id:"实验"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实验"}},[s._v("#")]),s._v(" 实验：")]),s._v(" "),e("p",[s._v("给nginx svc 增加一个 100.100.100.100 的ip")]),s._v(" "),e("p",[e("img",{attrs:{src:a(752),alt:"image-20220902171649394"}})]),s._v(" "),e("p",[s._v("查看proxy的mode是ipvs，进入服务器查看ipvs")]),s._v(" "),e("p",[e("img",{attrs:{src:a(753),alt:"image-20220902171745117"}})]),s._v(" "),e("p",[s._v("可以看到访问这个ip被负载到 90,97两个ip上")]),s._v(" "),e("p",[s._v("查看pod ip")]),s._v(" "),e("p",[e("img",{attrs:{src:a(754),alt:"image-20220902171835905"}})]),s._v(" "),e("p",[s._v("90,97 就是nginx pod ip，所以流量会在内部直接转发。")])])}),[],!1,null,null,null);t.default=p.exports}}]);