(window.webpackJsonp=window.webpackJsonp||[]).push([[163],{922:function(s,t,a){"use strict";a.r(t);var n=a(6),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"用户伪装-impersonation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用户伪装-impersonation"}},[s._v("#")]),s._v(" 用户伪装(Impersonation)")]),s._v(" "),a("blockquote",[a("p",[s._v("https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/authentication/#user-impersonation")])]),s._v(" "),a("p",[s._v("在使用 "),a("code",[s._v("kubectl")]),s._v(" 时，可以使用 "),a("code",[s._v("--as")]),s._v(" 标志来配置 "),a("code",[s._v("Impersonate-User")]),s._v(" 头部字段值， 使用 "),a("code",[s._v("--as-group")]),s._v(" 标志配置 "),a("code",[s._v("Impersonate-Group")]),s._v(" 头部字段值。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl drain mynode --as"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("superman --as-group"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("system:masters\nkc auth can-i delete ns --as"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("default --as-group"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("system:serviceaccount:default\nkc auth can-i  list endpointslices --as"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("system:kube-proxy\nkc auth can-i  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v(" endpointslices --as"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("system:kube-proxy\nkc auth can-i get endpointslices --as"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("system:kube-proxy\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"kubelet-port默认端口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubelet-port默认端口"}},[s._v("#")]),s._v(" kubelet port默认端口")]),s._v(" "),a("div",{staticClass:"language-go line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" ports\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// In this file, we can see all default port of cluster.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// It's also an important documentation for us. So don't remove them easily.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ProxyStatusPort is the default port for the proxy metrics server.")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// May be overridden by a flag at startup.")]),s._v("\n\tProxyStatusPort "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10249")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// KubeletPort is the default port for the kubelet server on each host machine.")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// May be overridden by a flag at startup.")]),s._v("\n\tKubeletPort "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10250")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// KubeletReadOnlyPort exposes basic read-only services from the kubelet.")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// May be overridden by a flag at startup.")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// This is necessary for heapster to collect monitoring stats from the kubelet")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// until heapster can transition to using the SSL endpoint.")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// TODO(roberthbailey): Remove this once we have a better solution for heapster.")]),s._v("\n\tKubeletReadOnlyPort "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10255")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// KubeletHealthzPort exposes a healthz endpoint from the kubelet.")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// May be overridden by a flag at startup.")]),s._v("\n\tKubeletHealthzPort "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10248")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ProxyHealthzPort is the default port for the proxy healthz server.")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// May be overridden by a flag at startup.")]),s._v("\n\tProxyHealthzPort "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10256")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// KubeControllerManagerPort is the default port for the controller manager status server.")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// May be overridden by a flag at startup.")]),s._v("\n\tKubeControllerManagerPort "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10257")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// CloudControllerManagerPort is the default port for the cloud controller manager server.")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// This value may be overridden by a flag at startup.")]),s._v("\n\tCloudControllerManagerPort "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10258")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])]),a("h3",{attrs:{id:"kubelet-本地-server-提供的接口列表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubelet-本地-server-提供的接口列表"}},[s._v("#")]),s._v(" kubelet 本地 server 提供的接口列表")]),s._v(" "),a("blockquote",[a("p",[s._v("函数如下，深入去代码里看, 挺多的")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("/healthz\n/pods\n/metrics\n/metrics/cadvisor\n/metrics/resource\n/metrics/probes\n/stats/\n/logs/\n/debug/pprof/\n/debug/flags/v\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])])]),s._v(" "),a("div",{staticClass:"language-go line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewServer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\thost HostInterface"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tresourceAnalyzer stats"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ResourceAnalyzer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tauth AuthInterface"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\ttp oteltrace"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("TracerProvider"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tkubeCfg "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("kubeletconfiginternal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("KubeletConfiguration"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n\tserver "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" Server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\thost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                 host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t\tresourceAnalyzer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("     resourceAnalyzer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t\tauth"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                 auth"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t\trestfulCont"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("filteringContainer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("Container"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" restful"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewContainer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t\tmetricsBuckets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("       sets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t\tmetricsMethodBuckets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OPTIONS"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HEAD"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"POST"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PUT"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DELETE"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TRACE"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CONNECT"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" auth "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("InstallAuthFilter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" utilfeature"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("DefaultFeatureGate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("features"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("KubeletTracing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("InstallTracingFilter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\tserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("InstallDefaultHandlers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" kubeCfg "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" kubeCfg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("EnableDebuggingHandlers "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("InstallDebuggingHandlers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// To maintain backward compatibility serve logs and pprof only when enableDebuggingHandlers is also enabled")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// see https://github.com/kubernetes/kubernetes/pull/87273")]),s._v("\n\t\tserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("InstallSystemLogHandler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kubeCfg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("EnableSystemLogHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\tserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("InstallProfilingHandler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kubeCfg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("EnableProfilingHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" kubeCfg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("EnableContentionProfiling"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\tserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("InstallDebugFlagsHandler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kubeCfg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("EnableDebugFlagsHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("InstallDebuggingDisabledHandlers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" server\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br")])]),a("h3",{attrs:{id:"k8s-匿名访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#k8s-匿名访问"}},[s._v("#")]),s._v(" k8s 匿名访问")]),s._v(" "),a("h4",{attrs:{id:"apiserver"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#apiserver"}},[s._v("#")]),s._v(" apiserver")]),s._v(" "),a("p",[s._v("里面的匿名访问,在 1.6 及之后版本中，如果所使用的鉴权模式不是 "),a("code",[s._v("AlwaysAllow")]),s._v("，则匿名访问默认是被启用的, "),a("strong",[s._v("所以现在自己创建的k8s是启用的")]),s._v("！这类请求获得用户名 "),a("code",[s._v("system:anonymous")]),s._v(" 和对应的用户组 "),a("code",[s._v("system:unauthenticated")])]),s._v(" "),a("blockquote",[a("p",[s._v("https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/authentication/#anonymous-requests")])]),s._v(" "),a("h4",{attrs:{id:"kubelet"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubelet"}},[s._v("#")]),s._v(" kubelet")]),s._v(" "),a("p",[s._v("匿名访问和apiserver一样，主要是鉴权，鉴权有两种方式 AlwaysAllow，Webhook")]),s._v(" "),a("p",[s._v("代码方法名字 "),a("code",[s._v("BuildAuthn 认证")]),s._v(" "),a("code",[s._v("BuildAuthz 鉴权")])]),s._v(" "),a("h4",{attrs:{id:"webhook"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webhook"}},[s._v("#")]),s._v(" Webhook")]),s._v(" "),a("p",[s._v("这个方式去 create "),a("code",[s._v("SubjectAccessReview")]),s._v(" obj 来鉴权")]),s._v(" "),a("blockquote",[a("p",[s._v("SubjectAccessReview checks whether or not a user or group can perform an\naction.")])]),s._v(" "),a("p",[s._v("这个种方式可以通过下面的crb来改变权限")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 看起来开启匿名好像也没啥问题，只要你不是想下面这样操作。。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterRoleBinding\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" anonymous"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("crb\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subjects")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Group\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("unauthenticated\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" User\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("anonymous\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("roleRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterRole\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("admin\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("具体创建描述如下")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('\n// Authorize makes a REST request to the remote service describing the attempted action as a JSON\n// serialized api.authorization.v1beta1.SubjectAccessReview object. An example request body is\n// provided below.\n//\n//\t{\n//\t  "apiVersion": "authorization.k8s.io/v1beta1",\n//\t  "kind": "SubjectAccessReview",\n//\t  "spec": {\n//\t    "resourceAttributes": {\n//\t      "namespace": "kittensandponies",\n//\t      "verb": "GET",\n//\t      "group": "group3",\n//\t      "resource": "pods"\n//\t    },\n//\t    "user": "jane",\n//\t    "group": [\n//\t      "group1",\n//\t      "group2"\n//\t    ]\n//\t  }\n//\t}\n//\n// The remote service is expected to fill the SubjectAccessReviewStatus field to either allow or\n// disallow access. A permissive response would return:\n//\n//\t{\n//\t  "apiVersion": "authorization.k8s.io/v1beta1",\n//\t  "kind": "SubjectAccessReview",\n//\t  "status": {\n//\t    "allowed": true\n//\t  }\n//\t}\n//\n// To disallow access, the remote service would return:\n//\n//\t{\n//\t  "apiVersion": "authorization.k8s.io/v1beta1",\n//\t  "kind": "SubjectAccessReview",\n//\t  "status": {\n//\t    "allowed": false,\n//\t    "reason": "user does not have read access to the namespace"\n//\t  }\n//\t}\n//\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);