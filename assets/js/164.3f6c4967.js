(window.webpackJsonp=window.webpackJsonp||[]).push([[164],{923:function(e,t,s){"use strict";s.r(t);var a=s(6),r=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"k8s-每日一问-kubelet-日志轮换-以及-resource-里面的-ephemeral-storage-文件大小是否会限制日志-可以看下文档-ephemeral-storage-log-file"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#k8s-每日一问-kubelet-日志轮换-以及-resource-里面的-ephemeral-storage-文件大小是否会限制日志-可以看下文档-ephemeral-storage-log-file"}},[e._v("#")]),e._v(" k8s 每日一问 - kubelet 日志轮换，以及 resource 里面的 ephemeral-storage 文件大小是否会限制日志，可以看下文档，ephemeral-storage = log+file?")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://kubernetes.io/zh-cn/docs/concepts/configuration/manage-resources-containers/#local-ephemeral-storage",target:"_blank",rel:"noopener noreferrer"}},[e._v("local-ephemeral-storage"),s("OutboundLink")],1)]),e._v(" "),s("p",[s("a",{attrs:{href:"https://kubernetes.io/zh-cn/docs/concepts/cluster-administration/logging/#logging-at-the-node-level",target:"_blank",rel:"noopener noreferrer"}},[e._v("日志"),s("OutboundLink")],1)]),e._v(" "),s("blockquote",[s("p",[e._v("都是通过 limits 的 ephemeral-storage 计算的")])]),e._v(" "),s("p",[s("strong",[e._v("kubelet")]),e._v(" 日志轮换： 通过kubelet 对这个"),s("code",[e._v("/var/log/pods/podNamespace_podName_string(podUID)/*.log")]),e._v(" 目录下面的日志按照配置进行rotate")]),e._v(" "),s("p",[e._v("pod 日志目录 "),s("code",[e._v("/var/log/pods/podNamespace_podName_string(podUID)/*.log")])]),e._v(" "),s("p",[e._v("stdout/stderr 日志算在 ephemeral-storage 里面的, "),s("strong",[e._v("如果直接在宿主机目录里面往pod日志目录写东西, 或者写/var/lib/kubelet/pods/${pod-uid}/etc-hosts ，当超出了ephemeral local storage 设定值都会被驱逐")])]),e._v(" "),s("p",[s("strong",[e._v("而且驱逐之后的日志目录确实会被删除！")])]),e._v(" "),s("h3",{attrs:{id:"ephemeral-storage-log-file"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ephemeral-storage-log-file"}},[e._v("#")]),e._v(" ephemeral-storage = log+file?")]),e._v(" "),s("p",[e._v("ephemeral-storage = "),s("code",[e._v("logs(/var/logs/pods/xxx/*.log)")]),e._v(" + "),s("code",[e._v("etc-hosts(/var/lib/kubelet/pods/${pod-uid}/etc-hosts )")]),e._v("+"),s("code",[e._v("rootFs(cadvisor 提供的数据)")]),e._v("+"),s("code",[e._v("pvc usedBytes(ephemeral类型的)")])]),e._v(" "),s("p",[e._v("代码在这个方法里面")]),e._v(" "),s("div",{staticClass:"language-go line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("func")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("p "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v("cadvisorStatsProvider"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("ListPodStats")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("_")]),e._v(" context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("Context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("statsapi"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("PodStats"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("error")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])])])}),[],!1,null,null,null);t.default=r.exports}}]);