(window.webpackJsonp=window.webpackJsonp||[]).push([[173],{927:function(s,t,n){"use strict";n.r(t);var a=n(6),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"iptables"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#iptables"}},[s._v("#")]),s._v(" iptables")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://www.zsythink.net/wp-content/uploads/2017/02/021217_0051_6.png",alt:""}})]),s._v(" "),n("blockquote",[n("p",[s._v("讲的很好 "),n("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/98210114",target:"_blank",rel:"noopener noreferrer"}},[s._v("iptables详解"),n("OutboundLink")],1)])]),s._v(" "),n("div",{staticClass:"language-textile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-textile"}},[n("code",[n("span",{pre:!0,attrs:{class:"token phrase"}},[s._v("处理动作\n处理动作在iptables中被称为target（这样说并不准确，我们暂且这样称呼），动作也可以分为基本动作和扩展动作。")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token phrase"}},[s._v("此处列出一些常用的动作，之后的文章会对它们进行详细的示例与总结：")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token phrase"}},[s._v("ACCEPT：允许数据包通过。")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token phrase"}},[s._v("DROP：直接丢弃数据包，不给任何回应信息，这时候客户端会感觉自己的请求泥牛入海了，过了超时时间才会有反应。")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token phrase"}},[s._v("REJECT：拒绝数据包通过，必要时会给数据发送端一个响应的信息，客户端刚请求就会收到拒绝的信息。")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token phrase"}},[s._v("SNAT：源地址转换，解决内网用户用同一个公网地址上网的问题。")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token phrase"}},[s._v("MASQUERADE：是SNAT的一种特殊形式，适用于动态的、临时会变的ip上。")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token phrase"}},[s._v("DNAT：目标地址转换。")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token phrase"}},[s._v("REDIRECT：在本机做端口映射。")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token phrase"}},[s._v("LOG：在/var/log/messages文件中记录日志信息，然后将数据包传递给下一条规则，也就是说除了记录以外不对数据包做任何其他操作，仍然让下一条规则去匹配。\n")])])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 末尾添加规则")]),s._v("\niptables -t filter -A INPUT -s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.146 -j DROP\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 首部添加一条规则")]),s._v("\niptables -t filter -I INPUT -s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.146 -j ACCEPT\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定位置添加一条规则")]),s._v("\niptables -t filter -I INPUT "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" -s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.146 -j REJECT\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将filter表中FORWARD链的默认策略设置为ACCEPT")]),s._v("\niptables -t filter -P FORWARD ACCEPT\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 按照规则序号删除规则")]),s._v("\niptables -t filter -D INPUT "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 按照具体的匹配条件与动作删除规则")]),s._v("\niptables -t filter -D INPUT -s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.146 -j DROP\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -F选项表示清空对应链中的规则")]),s._v("\niptables -t filter -F INPUT\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -R选项表示修改对应链中的规则，使用-R选项时要同时指定对应的链以及规则对应的序号，并且规则中原本的匹配条件不可省略")]),s._v("\niptables -t filter -R INPUT "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" -s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.146 -j ACCEPT\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改指定表的指定链的默认策略")]),s._v("\niptables -t filter -P FORWARD ACCEPT\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看对应表的所有规则")]),s._v("\niptables -t 表名 -L\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看指定表的指定链中的规则")]),s._v("\niptables -t 表名 -L 链名\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示更详细的信息")]),s._v("\niptables -t 表名 -v -L\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不对规则中的IP或者端口进行名称反解")]),s._v("\niptables -t 表名 -n -L\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示规则的序号，可以简写为–line")]),s._v("\niptables --line-numbers -t 表名 -L\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示查看表中的所有规则，并且显示更详细的信息(-v选项)，不过，计数器中的信息显示为精确的计数值，而不是显示为经过可读优化的计数值，-x选项表示显示计数器的精确值。")]),s._v("\niptables -t 表名 -v -x -L\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -s用于匹配报文的源地址,可以同时指定多个源地址，每个IP之间用逗号隔开，也可以指定为一个网段")]),s._v("\niptables -t filter -I INPUT -s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.111,192.168.1.118 -j DROP\niptables -t filter -I INPUT -s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.0/24 -j ACCEPT\niptables -t filter -I INPUT "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" -s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.0/24 -j ACCEPT\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -d用于匹配报文的目标地址,可以同时指定多个目标地址，每个IP之间用逗号隔开，也可以指定为一个网段。")]),s._v("\niptables -t filter -I OUTPUT -d "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.111,192.168.1.118 -j DROP\niptables -t filter -I INPUT -d "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.0/24 -j ACCEPT\niptables -t filter -I INPUT "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" -d "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.0/24 -j ACCEPT\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -p用于匹配报文的协议类型,可以匹配的协议类型tcp、udp、udplite、icmp、esp、ah、sctp等（centos7中还支持icmpv6、mh）。")]),s._v("\niptables -t filter -I INPUT -p tcp -s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.146 -j ACCEPT\niptables -t filter -I INPUT "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" -p udp -s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.146 -j ACCEPT\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -i用于匹配报文是从哪个网卡接口流入本机的，由于匹配条件只是用于匹配报文流入的网卡，所以在OUTPUT链与POSTROUTING链中不能使用此选项。")]),s._v("\niptables -t filter -I INPUT -p icmp -i eth4 -j DROP\niptables -t filter -I INPUT -p icmp "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" -i eth4 -j DROP\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -o用于匹配报文将要从哪个网卡接口流出本机，于匹配条件只是用于匹配报文流出的网卡，所以在INPUT链与PREROUTING链中不能使用此选项。")]),s._v("\niptables -t filter -I OUTPUT -p icmp -o eth4 -j DROP\niptables -t filter -I OUTPUT -p icmp "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" -o eth4 -j DROP\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -p tcp -m tcp –sport 用于匹配tcp协议报文的源端口，可以使用冒号指定一个连续的端口范围")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -p tcp -m tcp –dport 用于匹配tcp协议报文的目标端口，可以使用冒号指定一个连续的端口范围")]),s._v("\niptables -t filter -I OUTPUT -d "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.146 -p tcp -m tcp --sport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" -j REJECT\niptables -t filter -I INPUT -s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.146 -p tcp -m tcp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":25 -j REJECT\niptables -t filter -I INPUT -s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.146 -p tcp -m tcp --dport :22 -j REJECT\niptables -t filter -I INPUT -s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.146 -p tcp -m tcp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(": -j REJECT\niptables -t filter -I OUTPUT -d "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.146 -p tcp -m tcp "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" --sport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" -j ACCEPT\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -p tcp -m multiport –sports 用于匹配报文的源端口，可以指定离散的多个端口号,端口之间用”逗号”隔开")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -p udp -m multiport –dports 用于匹配报文的目标端口，可以指定离散的多个端口号，端口之间用”逗号”隔开")]),s._v("\niptables -t filter -I OUTPUT -d "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.146 -p udp -m multiport --sports "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("137,138")]),s._v(" -j REJECT\niptables -t filter -I INPUT -s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.146 -p tcp -m multiport --dports "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22,80")]),s._v(" -j REJECT\niptables -t filter -I INPUT -s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.146 -p tcp -m multiport "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" --dports "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22,80")]),s._v(" -j REJECT\niptables -t filter -I INPUT -s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.146 -p tcp -m multiport --dports "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":88 -j REJECT\niptables -t filter -I INPUT -s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.146 -p tcp -m multiport --dports "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22,80")]),s._v(":88 -j REJECT\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# –src-range：指定连续的源地址范围")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# –dst-range：指定连续的目标地址范围")]),s._v("\niptables -t filter -I INPUT -m iprange --src-range "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.127-192.168.1.146 -j DROP\niptables -t filter -I OUTPUT -m iprange --dst-range "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.127-192.168.1.146 -j DROP\niptables -t filter -I INPUT -m iprange "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" --src-range "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.127-192.168.1.146 -j DROP\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试过了好像没有用？")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# –algo：指定对应的匹配算法，可用算法为bm、kmp，此选项为必需选项。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# –string：指定需要匹配的字符串")]),s._v("\niptables -t filter -I INPUT -p tcp --sport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" -m string --algo bm --string "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OOXX"')]),s._v(" -j REJECT\niptables -t filter -I INPUT -p tcp --sport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" -m string --algo bm --string "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OOXX"')]),s._v(" -j REJECT\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#–timestart：用于指定时间范围的开始时间，不可取反")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# –timestop：用于指定时间范围的结束时间，不可取反")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#–weekdays：用于指定”星期几”，可取反")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#–monthdays：用于指定”几号”，可取反")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#–datestart：用于指定日期范围的开始日期，不可取反")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#–datestop：用于指定日期范围的结束时间，不可取反")]),s._v("\niptables -t filter -I OUTPUT -p tcp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" -m "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" --timestart 09:00:00 --timestop "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":00:00 -j REJECT\niptables -t filter -I OUTPUT -p tcp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" -m "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" --timestart 09:00:00 --timestop "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":00:00 -j REJECT\niptables -t filter -I OUTPUT -p tcp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("  -m "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" --weekdays "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6,7")]),s._v(" -j REJECT\niptables -t filter -I OUTPUT -p tcp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("  -m "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" --monthdays "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22,23")]),s._v(" -j REJECT\niptables -t filter -I OUTPUT -p tcp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("  -m "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" --monthdays "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22,23")]),s._v(" -j REJECT\niptables -t filter -I OUTPUT -p tcp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("  -m "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" --timestart 09:00:00 --timestop "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":00:00 --weekdays "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6,7")]),s._v(" -j REJECT\niptables -t filter -I OUTPUT -p tcp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("  -m "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" --weekdays "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" --monthdays "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22,23")]),s._v(",24,25,26,27,28 -j REJECT\niptables -t filter -I OUTPUT -p tcp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("  -m "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" --datestart "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),s._v("-12-24 --datestop "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),s._v("-12-27 -j REJECT\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# –connlimit-above：单独使用此选项时，表示限制每个IP的链接数量。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# –connlimit-mask：此选项不能单独使用，在使用–connlimit-above选项时，配合此选项，则可以针对”某类IP段内的一定数量的IP”进行连接数量的限制，如果不明白可以参考上文的详细解释。")]),s._v("\niptables -I INPUT -p tcp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" -m connlimit --connlimit-above "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" -j REJECT\niptables -I INPUT -p tcp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" -m connlimit --connlimit-above "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" --connlimit-mask "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" -j REJECT\niptables -I INPUT -p tcp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" -m connlimit --connlimit-above "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" --connlimit-mask "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" -j REJECT\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# limit模块")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 常用的扩展匹配条件如下")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# –limit-burst：类比”令牌桶”算法，此选项用于指定令牌桶中令牌的最大数量，上文中已经详细的描述了”令牌桶”的概念，方便回顾。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# –limit：类比”令牌桶”算法，此选项用于指定令牌桶中生成新令牌的频率，可用时间单位有second、minute 、hour、day。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#示例 #注意，如下两条规则需配合使用，具体原因上文已经解释过，忘记了可以回顾。")]),s._v("\niptables -t filter -I INPUT -p icmp -m limit --limit-burst "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" --limit "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("/minute -j ACCEPT\niptables -t filter -A INPUT -p icmp -j REJECT\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用于匹配tcp协议报文的源端口，可以使用冒号指定一个连续的端口范围")]),s._v("\niptables -t filter -I OUTPUT -d "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.146 -p tcp -m tcp --sport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" -j REJECT\niptables -t filter -I OUTPUT -d "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.146 -p tcp -m tcp --sport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":25 -j REJECT\niptables -t filter -I OUTPUT -d "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.146 -p tcp -m tcp "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" --sport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" -j ACCEPT\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用于匹配tcp协议报文的目标端口，可以使用冒号指定一个连续的端口范围")]),s._v("\niptables -t filter -I INPUT -s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.146 -p tcp -m tcp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":25 -j REJECT\niptables -t filter -I INPUT -s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.146 -p tcp -m tcp --dport :22 -j REJECT\niptables -t filter -I INPUT -s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.146 -p tcp -m tcp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(": -j REJECT\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用于匹配报文的tcp头的标志位")]),s._v("\niptables -t filter -I INPUT -p tcp -m tcp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" --tcp-flags SYN,ACK,FIN,RST,URG,PSH SYN -j REJECT\niptables -t filter -I OUTPUT -p tcp -m tcp --sport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" --tcp-flags SYN,ACK,FIN,RST,URG,PSH SYN,ACK -j REJECT\niptables -t filter -I INPUT -p tcp -m tcp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" --tcp-flags ALL SYN -j REJECT\niptables -t filter -I OUTPUT -p tcp -m tcp --sport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" --tcp-flags ALL SYN,ACK -j REJECT\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用于匹配tcp新建连接的请求报文，相当于使用”–tcp-flags SYN,RST,ACK,FIN  SYN”")]),s._v("\niptables -t filter -I INPUT -p tcp -m tcp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" --syn -j REJECT\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# –sport：匹配udp报文的源地址")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# –dport：匹配udp报文的目标地址")]),s._v("\niptables -t filter -I INPUT -p udp -m udp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("137")]),s._v(" -j ACCEPT\niptables -t filter -I INPUT -p udp -m udp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("137")]),s._v(":157 -j ACCEPT\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# –icmp-type：匹配icmp报文的具体类型")]),s._v("\niptables -t filter -I INPUT -p icmp -m icmp --icmp-type "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("/0 -j REJECT\niptables -t filter -I INPUT -p icmp --icmp-type "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" -j REJECT\niptables -t filter -I OUTPUT -p icmp -m icmp --icmp-type "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/0 -j REJECT\niptables -t filter -I OUTPUT -p icmp --icmp-type "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" -j REJECT\niptables -t filter -I INPUT -p icmp --icmp-type "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo-request"')]),s._v(" -j REJECT\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建自定义链")]),s._v("\niptables -t filter -N IN_WEB\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 引用自定义链")]),s._v("\niptables -t filter -I INPUT -p tcp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" -j IN_WEB\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重命名自定义链")]),s._v("\niptables -E IN_WEB WEB\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除自定义链")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1、自定义链没有被引用")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2、自定义链中没有任何规则")]),s._v("\niptables -X WEB\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br"),n("span",{staticClass:"line-number"},[s._v("118")]),n("br"),n("span",{staticClass:"line-number"},[s._v("119")]),n("br"),n("span",{staticClass:"line-number"},[s._v("120")]),n("br"),n("span",{staticClass:"line-number"},[s._v("121")]),n("br"),n("span",{staticClass:"line-number"},[s._v("122")]),n("br"),n("span",{staticClass:"line-number"},[s._v("123")]),n("br"),n("span",{staticClass:"line-number"},[s._v("124")]),n("br"),n("span",{staticClass:"line-number"},[s._v("125")]),n("br"),n("span",{staticClass:"line-number"},[s._v("126")]),n("br"),n("span",{staticClass:"line-number"},[s._v("127")]),n("br"),n("span",{staticClass:"line-number"},[s._v("128")]),n("br"),n("span",{staticClass:"line-number"},[s._v("129")]),n("br"),n("span",{staticClass:"line-number"},[s._v("130")]),n("br"),n("span",{staticClass:"line-number"},[s._v("131")]),n("br"),n("span",{staticClass:"line-number"},[s._v("132")]),n("br"),n("span",{staticClass:"line-number"},[s._v("133")]),n("br"),n("span",{staticClass:"line-number"},[s._v("134")]),n("br"),n("span",{staticClass:"line-number"},[s._v("135")]),n("br"),n("span",{staticClass:"line-number"},[s._v("136")]),n("br"),n("span",{staticClass:"line-number"},[s._v("137")]),n("br"),n("span",{staticClass:"line-number"},[s._v("138")]),n("br"),n("span",{staticClass:"line-number"},[s._v("139")]),n("br"),n("span",{staticClass:"line-number"},[s._v("140")]),n("br"),n("span",{staticClass:"line-number"},[s._v("141")]),n("br"),n("span",{staticClass:"line-number"},[s._v("142")]),n("br"),n("span",{staticClass:"line-number"},[s._v("143")]),n("br"),n("span",{staticClass:"line-number"},[s._v("144")]),n("br"),n("span",{staticClass:"line-number"},[s._v("145")]),n("br"),n("span",{staticClass:"line-number"},[s._v("146")]),n("br"),n("span",{staticClass:"line-number"},[s._v("147")]),n("br"),n("span",{staticClass:"line-number"},[s._v("148")]),n("br"),n("span",{staticClass:"line-number"},[s._v("149")]),n("br"),n("span",{staticClass:"line-number"},[s._v("150")]),n("br"),n("span",{staticClass:"line-number"},[s._v("151")]),n("br"),n("span",{staticClass:"line-number"},[s._v("152")]),n("br"),n("span",{staticClass:"line-number"},[s._v("153")]),n("br"),n("span",{staticClass:"line-number"},[s._v("154")]),n("br"),n("span",{staticClass:"line-number"},[s._v("155")]),n("br"),n("span",{staticClass:"line-number"},[s._v("156")]),n("br"),n("span",{staticClass:"line-number"},[s._v("157")]),n("br"),n("span",{staticClass:"line-number"},[s._v("158")]),n("br"),n("span",{staticClass:"line-number"},[s._v("159")]),n("br"),n("span",{staticClass:"line-number"},[s._v("160")]),n("br"),n("span",{staticClass:"line-number"},[s._v("161")]),n("br"),n("span",{staticClass:"line-number"},[s._v("162")]),n("br"),n("span",{staticClass:"line-number"},[s._v("163")]),n("br"),n("span",{staticClass:"line-number"},[s._v("164")]),n("br"),n("span",{staticClass:"line-number"},[s._v("165")]),n("br"),n("span",{staticClass:"line-number"},[s._v("166")]),n("br"),n("span",{staticClass:"line-number"},[s._v("167")]),n("br"),n("span",{staticClass:"line-number"},[s._v("168")]),n("br"),n("span",{staticClass:"line-number"},[s._v("169")]),n("br"),n("span",{staticClass:"line-number"},[s._v("170")]),n("br"),n("span",{staticClass:"line-number"},[s._v("171")]),n("br"),n("span",{staticClass:"line-number"},[s._v("172")]),n("br"),n("span",{staticClass:"line-number"},[s._v("173")]),n("br"),n("span",{staticClass:"line-number"},[s._v("174")]),n("br"),n("span",{staticClass:"line-number"},[s._v("175")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果想要iptables作为网络防火墙，iptables所在主机开启核心转发功能，以便能够转发报文。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用如下命令查看当前主机是否已经开启了核心转发，0表示为开启，1表示已开启")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /proc/sys/net/ipv4/ip_forward\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用如下两种方法均可临时开启核心转发，立即生效，但是重启网络配置后会失效。")]),s._v("\n方法一：echo "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /proc/sys/net/ipv4/ip_forward\n方法二：sysctl -w net.ipv4.ip_forward"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用如下方法开启核心转发功能，重启网络服务后永久生效。")]),s._v("\n配置/etc/sysctl.conf文件（centos7中配置/usr/lib/sysctl.d/00-system.conf文件），在配置文件中将 net.ipv4.ip_forward设置为1\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#由于iptables此时的角色为"网络防火墙"，所以需要在filter表中的FORWARD链中设置规则。')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#可以使用"白名单机制"，先添加一条默认拒绝的规则，然后再为需要放行的报文设置规则。')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#配置规则时需要考虑"方向问题"，针对请求报文与回应报文，考虑报文的源地址与目标地址，源端口与目标端口等。')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#示例为允许网络内主机访问网络外主机的web服务与sshd服务。")]),s._v("\niptables -A FORWARD -j REJECT\niptables -I FORWARD -s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.0/16 -p tcp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" -j ACCEPT\niptables -I FORWARD -d "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.0/16 -p tcp --sport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" -j ACCEPT\niptables -I FORWARD -s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.0/16 -p tcp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" -j ACCEPT\niptables -I FORWARD -d "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.0/16 -p tcp --sport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" -j ACCEPT\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#可以使用state扩展模块，对上述规则进行优化，使用如下配置可以省略许多"回应报文放行规则"。')]),s._v("\niptables -A FORWARD -j REJECT\niptables -I FORWARD -s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.0/16 -p tcp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" -j ACCEPT\niptables -I FORWARD -s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.0/16 -p tcp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" -j ACCEPT\niptables -I FORWARD -m state --state ESTABLISHED,RELATED -j ACCEPT\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果想要NAT功能能够正常使用，需要开启Linux主机的核心转发功能。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /proc/sys/net/ipv4/ip_forward\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# SNAT相关操作")]),s._v("\niptables -t nat -A POSTROUTING -s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.0/16 -j SNAT --to-source 公网IP\niptables -t nat -A POSTROUTING -s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.0/16 -o eth0 -j MASQUERADE\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# DNAT相关操作")]),s._v("\niptables -t nat -I PREROUTING -d 公网IP -p tcp --dport 公网端口 -j DNAT --to-destination 私网IP:端口号\niptables -t nat -I PREROUTING -d 公网IP -p tcp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" -j DNAT --to-destination "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.1:80\niptables -t nat -A POSTROUTING -s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.0/16 -j SNAT --to-source 公网IP\n\niptables -t nat -A PREROUTING -p tcp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" -j REDIRECT --to-ports "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[s._v("1、规则的顺序非常重要。")]),s._v(" "),n("p",[s._v("如果报文已经被前面的规则匹配到，IPTABLES则会对报文执行对应的动作，通常是ACCEPT或者REJECT，报文被放行或拒绝以后，即使后面的规则也能匹配到刚才放行或拒绝的报文，也没有机会再对报文执行相应的动作了（前面规则的动作为LOG时除外），所以，针对相同服务的规则，更严格的规则应该放在前面。")]),s._v(" "),n("p",[s._v("2、当规则中有多个匹配条件时，条件之间默认存在”与”的关系。")]),s._v(" "),n("p",[s._v("如果一条规则中包含了多个匹配条件，那么报文必须同时满足这个规则中的所有匹配条件，报文才能被这条规则匹配到。")]),s._v(" "),n("p",[s._v("3、在不考虑1的情况下，应该将更容易被匹配到的规则放置在前面。")]),s._v(" "),n("p",[s._v("比如，你写了两条规则，一条针对sshd服务，一条针对web服务。")]),s._v(" "),n("p",[s._v("假设，一天之内，有20000个请求访问web服务，有200个请求访问sshd服务，")]),s._v(" "),n("p",[s._v("那么，应该将针对web服务的规则放在前面，针对sshd的规则放在后面，因为访问web服务的请求频率更高。")]),s._v(" "),n("p",[s._v("如果将sshd的规则放在前面，当报文是访问web服务时，sshd的规则也要白白的验证一遍，由于访问web服务的频率更高，白白耗费的资源就更多。")]),s._v(" "),n("p",[s._v("如果web服务的规则放在前面，由于访问web服务的频率更高，所以无用功会比较少。")]),s._v(" "),n("p",[s._v("换句话说就是，在没有顺序要求的情况下，不同类别的规则，被匹配次数多的、匹配频率高的规则应该放在前面。")]),s._v(" "),n("p",[s._v("4、当IPTABLES所在主机作为网络防火 墙时，在配置规则时，应着重考虑方向性，双向都要考虑，从外到内，从内到外。")]),s._v(" "),n("p",[s._v("5、在配置IPTABLES白名单时，往往会将链的默认策略设置为ACCEPT，通过在链的最后设置REJECT规则实现白名单机制，而不是将链的默认策略设置为DROP，如果将链的默认策略设置为DROP，当链中的规则被清空时，管理员的请求也将会被DROP掉。")])])}),[],!1,null,null,null);t.default=e.exports}}]);